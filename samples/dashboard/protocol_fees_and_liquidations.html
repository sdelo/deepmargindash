<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Leviathan — Protocol Fees & Liquidations</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-b from-[#020617] to-[#0b1226] flex items-center justify-center min-h-screen">
  <!-- Protocol Fees Tracker -->
  <div class="w-[960px] rounded-3xl p-6 bg-white/10 backdrop-blur-2xl backdrop-saturate-150 shadow-2xl border-2 border-amber-400/70 ring-1 ring-cyan-300/40 relative text-white">
    <!-- Ambient Leviathan Glows -->
    <div class="pointer-events-none absolute inset-0 rounded-3xl bg-gradient-to-r from-amber-400/35 via-yellow-500/15 to-transparent blur-2xl -z-10"></div>
    <div class="pointer-events-none absolute inset-0 rounded-3xl bg-gradient-to-br from-cyan-300/20 via-blue-700/20 to-transparent blur-2xl -z-20"></div>

    <!-- Header -->
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-2xl font-extrabold tracking-wide text-amber-300 drop-shadow">Protocol Fees & Liquidations</h2>
      <span class="text-xs text-cyan-100/80">From <span class='text-amber-300'>protocol_fees</span> + linked <span class='text-amber-300'>LiquidationEvent</span></span>
    </div>
    <div class="h-px w-full bg-gradient-to-r from-transparent via-amber-300/60 to-transparent mb-6"></div>

    <!-- KPI Row -->
    <div class="grid grid-cols-4 gap-4 mb-6">
      <div class="rounded-2xl p-4 bg-white/5 border border-amber-400/30">
        <div class="text-xs text-cyan-100/80 mb-1">Cumulative Fees</div>
        <div class="text-3xl font-extrabold"><span id="fees-total" data-key="protocol_fees.total">42,580</span> <span class="text-sm text-cyan-100/70">units</span></div>
        <div class="text-[10px] text-cyan-100/60">since pool inception</div>
      </div>
      <div class="rounded-2xl p-4 bg-white/5 border border-amber-400/30">
        <div class="text-xs text-cyan-100/80 mb-1">24h Fees</div>
        <div class="text-2xl font-bold"><span id="fees-24h" data-key="protocol_fees.last_24h">620</span></div>
        <div class="text-[10px] text-cyan-100/60">rolling 24h</div>
      </div>
      <div class="rounded-2xl p-4 bg-white/5 border border-amber-400/30">
        <div class="text-xs text-cyan-100/80 mb-1">7d Fees</div>
        <div class="text-2xl font-bold"><span id="fees-7d" data-key="protocol_fees.last_7d">4,110</span></div>
        <div class="text-[10px] text-cyan-100/60">rolling 7d</div>
      </div>
      <div class="rounded-2xl p-4 bg-white/5 border border-amber-400/30 relative overflow-hidden">
        <div class="text-xs text-cyan-100/80 mb-1">Liquidations (cumulative)</div>
        <div class="text-2xl font-bold flex items-baseline gap-1"><span id="liq-total" data-key="liquidation_events.total">1,260</span><span class="text-sm">events</span></div>
        <div class="text-[10px] text-cyan-100/60">linked to MarginPools</div>
        <span class="pointer-events-none absolute -right-6 -bottom-6 w-20 h-20 rounded-full bg-amber-300/15 blur-xl"></span>
      </div>
    </div>

    <!-- Charts: Fees + Liquidations -->
    <div class="rounded-2xl p-5 bg-white/5 border border-amber-400/30 relative overflow-hidden">
      <div class="flex items-center justify-between mb-3">
        <div class="text-sm text-cyan-100/90">Fees & Liquidations Over Time</div>
        <div class="text-[11px] text-cyan-100/70">Bars = Fees · Stacked Bars = Liquidations · Line = Cumulative Fees</div>
      </div>
      <svg viewBox="0 0 840 340" class="w-full h-[300px]">
        <!-- Axes -->
        <line x1="60" y1="300" x2="800" y2="300" stroke="rgba(255,255,255,0.25)" stroke-width="1" />
        <line x1="60" y1="40" x2="60" y2="300" stroke="rgba(255,255,255,0.25)" stroke-width="1" />
        <!-- Grid -->
        <g opacity="0.15">
          <line x1="200" y1="40" x2="200" y2="300" stroke="white" />
          <line x1="340" y1="40" x2="340" y2="300" stroke="white" />
          <line x1="480" y1="40" x2="480" y2="300" stroke="white" />
          <line x1="620" y1="40" x2="620" y2="300" stroke="white" />
        </g>
        <!-- Daily fees bars (mock) -->
        <g fill="#fbbf24" fill-opacity="0.55">
          <rect x="80" y="240" width="18" height="40"></rect>
          <rect x="110" y="230" width="18" height="50"></rect>
          <rect x="140" y="225" width="18" height="55"></rect>
          <rect x="170" y="235" width="18" height="45"></rect>
          <rect x="200" y="220" width="18" height="60"></rect>
          <rect x="230" y="215" width="18" height="65"></rect>
        </g>
        <!-- Cumulative fees line -->
        <polyline fill="none" stroke="#fbbf24" stroke-width="3" points="60,290 120,280 180,265 240,250 300,235 360,220 420,210 480,195 540,180 600,170 660,160 720,150 780,140" />
        <!-- Liquidation stacked bars (amber = pool_reward, rose = pool_default) -->
        <g>
          <!-- Example liquidation event -->
          <rect x="200" y="260" width="18" height="20" fill="#fbbf24" />
          <rect x="200" y="250" width="18" height="10" fill="#fb7185" />
          <rect x="480" y="255" width="18" height="25" fill="#fbbf24" />
          <rect x="480" y="245" width="18" height="10" fill="#fb7185" />
        </g>
      </svg>
      <!-- Legend -->
      <div class="flex items-center gap-6 mt-3 text-[12px] text-cyan-100/80">
        <div class="flex items-center gap-2"><span class="w-3 h-3 bg-amber-300 inline-block rounded-sm"></span> Pool Reward</div>
        <div class="flex items-center gap-2"><span class="w-3 h-3 bg-rose-400 inline-block rounded-sm"></span> Pool Default</div>
        <div class="flex items-center gap-2"><span class="w-3 h-3 bg-amber-300/60 inline-block"></span> Daily Fees</div>
        <div class="flex items-center gap-2"><span class="w-5 h-[2px] bg-amber-300 inline-block"></span> Cumulative Fees</div>
      </div>
      <!-- Glow flares -->
      <span class="pointer-events-none absolute -right-12 -bottom-10 w-40 h-40 rounded-full bg-amber-300/15 blur-2xl"></span>
      <span class="pointer-events-none absolute -left-10 -top-12 w-36 h-36 rounded-full bg-cyan-300/15 blur-2xl"></span>
    </div>

    <!-- Breakdown Row -->
    <div class="grid grid-cols-3 gap-5 mt-6">
      <div class="rounded-2xl p-4 bg-white/5 border border-amber-400/30">
        <div class="text-xs text-cyan-100/80 mb-1">Spread Fees</div>
        <div class="text-xl font-bold text-amber-300"><span id="fees-spread" data-key="protocol_fees.spread">28,400</span></div>
        <div class="text-[10px] text-cyan-100/60">from protocol_spread</div>
      </div>
      <div class="rounded-2xl p-4 bg-white/5 border border-amber-400/30">
        <div class="text-xs text-cyan-100/80 mb-1">Liquidation Fees (Pool Reward)</div>
        <div class="text-xl font-bold text-amber-300"><span id="fees-liq" data-key="liquidation_events.pool_reward">11,600</span></div>
        <div class="text-[10px] text-cyan-100/60">sum of pool_reward from LiquidationEvent</div>
      </div>
      <div class="rounded-2xl p-4 bg-white/5 border border-amber-400/30">
        <div class="text-xs text-cyan-100/80 mb-1">Defaults (Pool Loss)</div>
        <div class="text-xl font-bold text-rose-300"><span id="fees-default" data-key="liquidation_events.pool_default">1,250</span></div>
        <div class="text-[10px] text-cyan-100/60">cumulative pool_default (losses)</div>
      </div>
    </div>

    <!-- Footnote / Governance -->
    <div class="mt-6 text-[11px] text-cyan-100/70 leading-relaxed">
      This tracker integrates <span class="text-amber-300">protocol_fees</span> with <span class="text-amber-300">LiquidationEvent</span> data. It shows cumulative fees, rolling fee windows, and liquidation-linked metrics: <span class="text-cyan-200">pool_reward</span> (credited to pools) and <span class="text-cyan-200">pool_default</span> (losses). Liquidations are rendered as stacked bars (amber = reward, rose = default) for clarity, alongside daily fee bars and the cumulative fee line. Use <code class="text-cyan-200">margin_pool_id</code> to link events back to pools for governance and risk transparency.
    </div>
  </div>
</body>
</html>